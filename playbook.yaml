---
- name: Install wigglecam via pipx into system Python
  hosts: all        # oder 'all', je nach Inventar
  become: false

  pre_tasks:
    - name: Ensure apt index is up to date
      become: true
      ansible.builtin.apt:
        update_cache: true

    - name: Upgrade system packages
      become: true
      ansible.builtin.apt:
        upgrade: dist

  tasks:
    - name: Ensure pipx is installed
      become: true
      ansible.builtin.apt:
        name: pipx
        state: present
        update_cache: false

    - name: Ensure apps prerequisites are installed
      become: true
      ansible.builtin.apt:
        name:
          - python3-dev
          - python3-venv
          - python3-pip
          - build-essential
          - libnng-dev
        state: present
        update_cache: false

    - name: Install wigglecam with pipx into system Python
      become: false
      environment:
        TMPDIR: /var/tmp
      ansible.builtin.command: >
        pipx install --system-site-packages wigglecam[node]
      args:
        creates: wigglecam-node
